#include "ui_font_bitmap.h"

const ui_font_bitmap_glyph_t g_ui_font_bitmap_glyphs[UI_FONT_BITMAP_COUNT] = {
    {     0,  0,  0,   0,  12,  7 }, /* ' ' */
    {     0,  7,  9,   0,   3,  7 }, /* '!' */
    {     9,  7,  9,   0,   3,  7 }, /* '"' */
    {    18,  8,  9,   0,   3,  7 }, /* '#' */
    {    27,  7, 11,   0,   3,  7 }, /* '$' */
    {    38,  8,  8,   0,   4,  7 }, /* '%' */
    {    46,  8,  9,   0,   3,  7 }, /* '&' */
    {    55,  7,  9,   0,   3,  7 }, /* "'" */
    {    64,  7, 11,   0,   2,  7 }, /* '(' */
    {    75,  7, 11,   0,   2,  7 }, /* ')' */
    {    86,  7,  7,   0,   5,  7 }, /* '*' */
    {    93,  7,  7,   0,   5,  7 }, /* '+' */
    {   100,  7,  4,   0,  10,  7 }, /* ',' */
    {   104,  7,  4,   0,   8,  7 }, /* '-' */
    {   108,  7,  2,   0,  10,  7 }, /* '.' */
    {   110,  7, 10,   0,   3,  7 }, /* '/' */
    {   120,  7,  9,   0,   3,  7 }, /* '0' */
    {   129,  7,  9,   0,   3,  7 }, /* '1' */
    {   138,  7,  9,   0,   3,  7 }, /* '2' */
    {   147,  7,  9,   0,   3,  7 }, /* '3' */
    {   156,  7,  9,   0,   3,  7 }, /* '4' */
    {   165,  7,  9,   0,   3,  7 }, /* '5' */
    {   174,  7,  9,   0,   3,  7 }, /* '6' */
    {   183,  7,  9,   0,   3,  7 }, /* '7' */
    {   192,  7,  9,   0,   3,  7 }, /* '8' */
    {   201,  7,  9,   0,   3,  7 }, /* '9' */
    {   210,  7,  6,   0,   6,  7 }, /* ':' */
    {   216,  7,  8,   0,   6,  7 }, /* ';' */
    {   224,  7,  7,   0,   5,  7 }, /* '<' */
    {   231,  7,  6,   0,   6,  7 }, /* '=' */
    {   237,  7,  7,   0,   5,  7 }, /* '>' */
    {   244,  7,  9,   0,   3,  7 }, /* '?' */
    {   253,  7, 11,   0,   4,  7 }, /* '@' */
    {   264,  8,  9,   0,   3,  7 }, /* 'A' */
    {   273,  7,  9,   0,   3,  7 }, /* 'B' */
    {   282,  7,  9,   0,   3,  7 }, /* 'C' */
    {   291,  7,  9,   0,   3,  7 }, /* 'D' */
    {   300,  7,  9,   0,   3,  7 }, /* 'E' */
    {   309,  7,  9,   0,   3,  7 }, /* 'F' */
    {   318,  7,  9,   0,   3,  7 }, /* 'G' */
    {   327,  7,  9,   0,   3,  7 }, /* 'H' */
    {   336,  7,  9,   0,   3,  7 }, /* 'I' */
    {   345,  7,  9,   0,   3,  7 }, /* 'J' */
    {   354,  8,  9,   0,   3,  7 }, /* 'K' */
    {   363,  7,  9,   0,   3,  7 }, /* 'L' */
    {   372,  7,  9,   0,   3,  7 }, /* 'M' */
    {   381,  7,  9,   0,   3,  7 }, /* 'N' */
    {   390,  7,  9,   0,   3,  7 }, /* 'O' */
    {   399,  7,  9,   0,   3,  7 }, /* 'P' */
    {   408,  7, 11,   0,   3,  7 }, /* 'Q' */
    {   419,  8,  9,   0,   3,  7 }, /* 'R' */
    {   428,  7,  9,   0,   3,  7 }, /* 'S' */
    {   437,  7,  9,   0,   3,  7 }, /* 'T' */
    {   446,  7,  9,   0,   3,  7 }, /* 'U' */
    {   455,  7,  9,   0,   3,  7 }, /* 'V' */
    {   464,  8,  9,   0,   3,  7 }, /* 'W' */
    {   473,  8,  9,   0,   3,  7 }, /* 'X' */
    {   482,  8,  9,   0,   3,  7 }, /* 'Y' */
    {   491,  7,  9,   0,   3,  7 }, /* 'Z' */
    {   500,  7, 11,   0,   2,  7 }, /* '[' */
    {   511,  7, 10,   0,   3,  7 }, /* '\' */
    {   521,  7, 11,   0,   2,  7 }, /* ']' */
    {   532,  8,  9,   0,   3,  7 }, /* '^' */
    {   541,  8,  2,   0,  12,  7 }, /* '_' */
    {   543,  7, 10,   0,   2,  7 }, /* '`' */
    {   553,  7,  7,   0,   5,  7 }, /* 'a' */
    {   560,  7, 10,   0,   2,  7 }, /* 'b' */
    {   570,  7,  7,   0,   5,  7 }, /* 'c' */
    {   577,  7, 10,   0,   2,  7 }, /* 'd' */
    {   587,  7,  7,   0,   5,  7 }, /* 'e' */
    {   594,  7, 10,   0,   2,  7 }, /* 'f' */
    {   604,  7, 10,   0,   5,  7 }, /* 'g' */
    {   614,  7, 10,   0,   2,  7 }, /* 'h' */
    {   624,  7,  9,   0,   3,  7 }, /* 'i' */
    {   633,  7, 13,   0,   2,  7 }, /* 'j' */
    {   646,  8, 10,   0,   2,  7 }, /* 'k' */
    {   656,  7,  9,   0,   3,  7 }, /* 'l' */
    {   665,  7,  7,   0,   5,  7 }, /* 'm' */
    {   672,  7,  7,   0,   5,  7 }, /* 'n' */
    {   679,  7,  7,   0,   5,  7 }, /* 'o' */
    {   686,  7, 10,   0,   5,  7 }, /* 'p' */
    {   696,  7, 10,   0,   5,  7 }, /* 'q' */
    {   706,  7,  7,   0,   5,  7 }, /* 'r' */
    {   713,  7,  7,   0,   5,  7 }, /* 's' */
    {   720,  7,  9,   0,   3,  7 }, /* 't' */
    {   729,  7,  7,   0,   5,  7 }, /* 'u' */
    {   736,  7,  7,   0,   5,  7 }, /* 'v' */
    {   743,  8,  7,   0,   5,  7 }, /* 'w' */
    {   750,  7,  7,   0,   5,  7 }, /* 'x' */
    {   757,  7, 10,   0,   5,  7 }, /* 'y' */
    {   767,  7,  7,   0,   5,  7 }, /* 'z' */
    {   774,  7, 11,   0,   2,  7 }, /* '{' */
    {   785,  7, 12,   0,   3,  7 }, /* '|' */
    {   797,  7, 11,   0,   2,  7 }, /* '}' */
    {   808,  8,  6,   0,   6,  7 }, /* '~' */
};

const uint8_t g_ui_font_bitmap_bits[] = {
    0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x0C,0x26,0x26,0x26,0x26,0x00,0x00,0x00,
    0x00,0x00,0x14,0x14,0x7E,0x24,0x28,0x28,0xFE,0x48,0x50,0x08,0x1C,0x3A,0x28,0x18,
    0x0E,0x0A,0x2A,0x1E,0x08,0x08,0x60,0x90,0x62,0x18,0x6C,0x12,0x12,0x0C,0x38,0x60,
    0x60,0x20,0x70,0x52,0x8A,0x44,0x3A,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x00,0x00,
    0x04,0x08,0x08,0x08,0x18,0x10,0x18,0x08,0x08,0x08,0x04,0x10,0x08,0x08,0x08,0x04,
    0x04,0x04,0x08,0x08,0x08,0x10,0x08,0x08,0x3A,0x1C,0x3A,0x08,0x08,0x08,0x08,0x08,
    0x3F,0x08,0x08,0x00,0x08,0x08,0x18,0x10,0x3F,0x00,0x00,0x00,0x18,0x18,0x02,0x02,
    0x04,0x04,0x08,0x08,0x10,0x10,0x20,0x20,0x1C,0x36,0x26,0x26,0x2A,0x32,0x32,0x32,
    0x1C,0x1C,0x3C,0x0C,0x0C,0x0C,0x0C,0x0C,0x0C,0x1E,0x1C,0x26,0x02,0x02,0x04,0x08,
    0x18,0x30,0x3E,0x1C,0x22,0x02,0x06,0x1C,0x02,0x02,0x22,0x1C,0x04,0x0C,0x0C,0x14,
    0x24,0x24,0x3F,0x04,0x04,0x3E,0x20,0x20,0x3C,0x06,0x02,0x02,0x26,0x1C,0x1C,0x32,
    0x20,0x2C,0x32,0x22,0x22,0x32,0x1C,0x3E,0x02,0x06,0x04,0x04,0x08,0x08,0x08,0x10,
    0x1C,0x32,0x22,0x32,0x1C,0x22,0x22,0x22,0x1C,0x1C,0x22,0x22,0x22,0x22,0x1E,0x02,
    0x06,0x1C,0x08,0x08,0x00,0x00,0x08,0x08,0x08,0x08,0x00,0x00,0x08,0x08,0x18,0x18,
    0x03,0x0E,0x30,0x30,0x0E,0x03,0x00,0x3F,0x00,0x00,0x3F,0x00,0x00,0x20,0x18,0x06,
    0x06,0x18,0x20,0x00,0x1C,0x02,0x02,0x04,0x08,0x08,0x00,0x08,0x08,0x1E,0x31,0x2F,
    0x49,0x51,0x49,0x4F,0x20,0x20,0x1E,0x00,0x10,0x38,0x28,0x28,0x2C,0x44,0x7C,0x46,
    0xC2,0x3C,0x22,0x22,0x22,0x3C,0x22,0x23,0x22,0x3E,0x0E,0x10,0x20,0x20,0x20,0x20,
    0x20,0x10,0x0E,0x3C,0x26,0x22,0x22,0x22,0x22,0x22,0x26,0x3C,0x3E,0x20,0x20,0x20,
    0x3E,0x20,0x20,0x20,0x3E,0x3F,0x30,0x30,0x30,0x3E,0x30,0x30,0x30,0x30,0x1E,0x30,
    0x20,0x20,0x26,0x22,0x22,0x32,0x1E,0x22,0x22,0x22,0x22,0x3E,0x22,0x22,0x22,0x22,
    0x3E,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x3E,0x1E,0x06,0x06,0x06,0x06,0x06,0x06,
    0x04,0x3C,0x46,0x4C,0x58,0x70,0x70,0x48,0x4C,0x44,0x46,0x20,0x20,0x20,0x20,0x20,
    0x20,0x20,0x20,0x3F,0x62,0x66,0x76,0x52,0x5A,0x4A,0x42,0x42,0x42,0x62,0x62,0x72,
    0x52,0x4A,0x4A,0x46,0x46,0x42,0x1C,0x32,0x22,0x22,0x23,0x22,0x22,0x32,0x1C,0x3E,
    0x22,0x23,0x22,0x3E,0x20,0x20,0x20,0x20,0x1C,0x32,0x22,0x22,0x23,0x22,0x22,0x32,
    0x1C,0x06,0x02,0x78,0x44,0x44,0x44,0x78,0x4C,0x44,0x46,0x42,0x1C,0x22,0x20,0x30,
    0x1C,0x02,0x02,0x22,0x1C,0x7F,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x22,0x22,
    0x22,0x22,0x22,0x22,0x22,0x22,0x1C,0x61,0x22,0x22,0x22,0x12,0x14,0x14,0x1C,0x08,
    0x82,0x82,0x92,0x5A,0x4A,0x6C,0x6C,0x6C,0x64,0x46,0x64,0x28,0x18,0x18,0x38,0x2C,
    0x44,0xC2,0xC6,0x44,0x2C,0x38,0x10,0x10,0x10,0x10,0x10,0x3F,0x02,0x06,0x04,0x08,
    0x08,0x10,0x20,0x3F,0x0E,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x0E,0x20,
    0x20,0x10,0x10,0x08,0x08,0x04,0x04,0x02,0x02,0x18,0x08,0x08,0x08,0x08,0x08,0x08,
    0x08,0x08,0x08,0x18,0x10,0x38,0x6C,0x46,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,0x10,
    0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x02,0x02,0x1E,0x22,0x22,0x1A,
    0x20,0x20,0x20,0x2C,0x32,0x22,0x22,0x22,0x32,0x3C,0x0E,0x10,0x20,0x20,0x20,0x10,
    0x0E,0x02,0x02,0x02,0x1E,0x26,0x22,0x22,0x22,0x26,0x1A,0x1C,0x32,0x22,0x3F,0x20,
    0x20,0x1E,0x06,0x08,0x08,0x3E,0x08,0x08,0x08,0x08,0x08,0x08,0x1E,0x26,0x22,0x22,
    0x22,0x26,0x1A,0x02,0x06,0x1C,0x20,0x20,0x20,0x2C,0x32,0x22,0x22,0x22,0x22,0x22,
    0x04,0x00,0x1C,0x04,0x04,0x04,0x04,0x04,0x3F,0x04,0x00,0x00,0x1C,0x04,0x04,0x04,
    0x04,0x04,0x04,0x0C,0x08,0x38,0x60,0x60,0x60,0x64,0x68,0x70,0x78,0x68,0x64,0x66,
    0x38,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x07,0x3E,0x29,0x29,0x29,0x29,0x29,0x29,
    0x2C,0x32,0x22,0x22,0x22,0x22,0x22,0x1C,0x32,0x22,0x22,0x22,0x32,0x1C,0x3C,0x32,
    0x22,0x22,0x22,0x32,0x3C,0x20,0x20,0x20,0x1E,0x36,0x22,0x22,0x22,0x36,0x1E,0x02,
    0x02,0x02,0x1F,0x18,0x10,0x10,0x10,0x10,0x10,0x1C,0x32,0x30,0x1C,0x02,0x22,0x1C,
    0x08,0x08,0x3E,0x08,0x08,0x08,0x08,0x08,0x0E,0x22,0x22,0x22,0x22,0x22,0x32,0x1A,
    0x22,0x22,0x32,0x14,0x14,0x1C,0x08,0x82,0x82,0x52,0x54,0x6C,0x6C,0x64,0x22,0x14,
    0x1C,0x08,0x1C,0x12,0x22,0x23,0x22,0x32,0x16,0x14,0x0C,0x08,0x08,0x08,0x30,0x3E,
    0x02,0x04,0x08,0x10,0x10,0x3E,0x06,0x0C,0x08,0x08,0x08,0x30,0x08,0x08,0x08,0x0C,
    0x06,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x38,0x08,0x08,
    0x08,0x08,0x06,0x0C,0x08,0x08,0x08,0x38,0x00,0x60,0x92,0x0C,0x00,0x00,
};

/* Draw a single glyph at (x, y) baseline position */
static void ui_font_bitmap_draw_glyph(ui_font_bitmap_plot_fn plot,
                                      ui_font_bitmap_rect_fn rect,
                                      void *user,
                                      int x, int y,
                                      const ui_font_bitmap_glyph_t *g,
                                      uint16_t fg,
                                      uint16_t bg)
{
    if (!g || g->w == 0 || g->h == 0)
        return;

    const int gx = x + g->xoff;
    const int gy = y + g->yoff;
    const int w = g->w;
    const int h = g->h;
    const int bytes_per_row = (w + 7) / 8;
    const uint8_t *bits = &g_ui_font_bitmap_bits[g->offset];

    /* Draw background rect if rect callback provided */
    if (rect && bg != 0xFFFFu) {
        rect(gx, gy, w, h, bg, user);
    }

    /* Draw foreground pixels */
    if (!plot)
        return;

    for (int row = 0; row < h; ++row) {
        int col = 0;
        for (int b = 0; b < bytes_per_row; ++b) {
            uint8_t byte = bits[row * bytes_per_row + b];
            for (int bit = 7; bit >= 0 && col < w; --bit, ++col) {
                if (byte & (1u << bit)) {
                    plot(gx + col, gy + row, fg, user);
                }
            }
        }
    }
}

void ui_font_bitmap_draw_text(ui_font_bitmap_plot_fn plot,
                              ui_font_bitmap_rect_fn rect,
                              void *user,
                              int x, int y,
                              const char *text,
                              uint16_t fg,
                              uint16_t bg)
{
    if (!text)
        return;

    int cursor_x = x;
    for (const char *p = text; *p; ++p) {
        const ui_font_bitmap_glyph_t *g = ui_font_bitmap_glyph(*p);
        ui_font_bitmap_draw_glyph(plot, rect, user, cursor_x, y, g, fg, bg);
        cursor_x += g->xadv;
    }
}
